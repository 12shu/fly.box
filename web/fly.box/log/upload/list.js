!function () { var B = fly, G = !!B.getQuery("$with-org"), _ = B.getQuery("fileId"), F = B.getQuery("fileName"), $ = B.getQuery("start-time"), E = B.getQuery("end-time"), C = B.getQuery("userId"), D = B.getQuery("userName"), A = [D, F].where("o=>o!=null").join("\u3001"); B.box.UploadList = B.Class({ name: "\u65e5\u5fd7", title: "\u4e0a\u4f20\u65e5\u5fd7" + (A ? "\uff08{0}\uff09".format(A) : ""), base: B.base.ListBase, module: "Log", startTime: $, endTime: E, userId: C, actionPage: window.location.href.replace(/\/upload/i, "/action"), getActionPage: function (A, $, _) { var C = B.appendQuery({ "start-time": page.startTime, "end-time": page.endTime, action: A, fileId: $, fileName: _ }, page.actionPage); return C }, buttons: ['<span id="start-time" class="input-append">' + '<input data-format="yyyy-MM-dd" type="text" style="width:100px" ondblclick="this.value=\'\'"/>' + '<span class="add-on">' + '<i data-time-icon="icon-time" data-date-icon="icon-calendar">' + "</i></span>" + "</span>", '<span id="end-time" class="input-append">' + '<input data-format="yyyy-MM-dd" type="text" style="width:100px" ondblclick="this.value=\'\'"/>' + '<span class="add-on">' + '<i data-time-icon="icon-time" data-date-icon="icon-calendar">' + "</i></span>" + "</span>", '<a onclick="page.query()">\u67e5\u8be2</a>'], pageUrl: B.base.ajaxUrl("Log", "Upload"), defaultStoreArgs: { fileId: _, "start-time": $, "end-time": E, userId: C }, gridConfig: { columns: [B.common.createSelection(), { dataIndex: "Name", header: "\u6587\u4ef6\u540d\u79f0" }, { dataIndex: "User", header: "\u4e0a\u4f20\u7528\u6237" }, { dataIndex: "Time", header: "\u4e0a\u4f20\u65f6\u95f4", renderer: function ($) { return $.format("yyyy-MM-dd HH:mm") } }, { dataIndex: "Download", header: "\u4e0b\u8f7d\u3001\u6d4f\u89c8\u6b21\u6570", renderer: function ($, _) { var A = page.getActionPage("download", _.record.Id, _.record.Name); return '<a href="{0}" title=\u67e5\u770b\u4e0b\u8f7d\u8be6\u60c5 onclick="return page.openAction(this)">{1}</a>'.format(A, $) } }, { dataIndex: "Fav", header: "\u6536\u85cf\u6b21\u6570", renderer: function ($, _) { var A = page.getActionPage("fav", _.record.Id, _.record.Name); return '<a href="{0}" title=\u67e5\u770b\u6536\u85cf\u8be6\u60c5 onclick="return page.openAction(this)">{1}</a>'.format(A, $) } }, { dataIndex: "Comment", header: "\u8bc4\u8bba\u6b21\u6570", renderer: function ($, _) { var A = page.getActionPage("comment", _.record.Id, _.record.Name); return '<a href="{0}" title=\u67e5\u770b\u8bc4\u8bba\u8be6\u60c5 onclick="return page.openAction(this)">{1}</a>'.format(A, $) } }, { dataIndex: "Score", header: "\u603b\u5206/\u8bc4\u5206\u6b21\u6570=\u5e73\u5747\u5206", renderer: function ($, _) { var A = page.getActionPage("score", _.record.Id, _.record.Name); return "<a href='{3}' title=\u67e5\u770b\u8bc4\u5206\u60c5\u51b5 onclick='return page.openAction(this)'>{0} / {1} = {2}</a>".format(_.record.ScoreSum || 0, _.record.Score || 0, (_.record.ScoreSum || 0) / (_.record.Score || 1), A) } }] }, query: function () { this.startTime = B("#start-time input").val(); this.endTime = B("#end-time input").val(); B.extend(this.store.params, { "start-time": this.startTime, "end-time": this.endTime, userId: this.userId }); this.pager.go(1, true) }, openAction: function ($) { var _ = {}; if (!frameElement || frameElement.getAttribute("isFramePage") != 1) _.otherHtml = B.common.framePageCloseButton; B.common.openFrame(window, $.href, _); return false }, onInit: function () { setTimeout(function () { page.startPicker = jQuery("#start-time").datetimepicker({ pickTime: false, language: "cn" }); page.endPicker = jQuery("#end-time").datetimepicker({ pickTime: false, language: "cn" }); page.startTime && B("#start-time input").val(page.startTime); page.endTime && B("#end-time input").val(page.endTime) }) } }); B.Style.loadCss("../../../fly.common/bootstrap/css/bootstrap.min.css"); B.Style.loadCss("../../../fly.common/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css"); B.loadScript("../../../fly.common/jQuery/jquery.js", function () { B.loadScript("../../../fly.common/bootstrap/js/bootstrap.min.js", function () { B.loadScript("../../../fly.common/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js", function () { window.page = new B.box.UploadList(); page.show() }) }) }) } ()