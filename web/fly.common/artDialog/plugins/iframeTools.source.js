/*!
* artDialog iframeTools
* Date: 2011-11-25 13:54
* http://code.google.com/p/artdialog/
* (c) 2009-2011 TangBin, http://www.planeArt.cn
*
* This is licensed under the GNU LGPL, version 2.1 or later.
* For details, see: http://creativecommons.org/licenses/LGPL/2.1/
*/

(function (D, A, F, C) { var B, K, $, J = "@ARTDIALOG.DATA", H = "@ARTDIALOG.OPEN", E = "@ARTDIALOG.OPENER", G = A.name = A.name || "@ARTDIALOG.WINNAME" + +new Date, _ = A.VBArray && !A.XMLHttpRequest; D(function () { !A.jQuery && document.compatMode === "BackCompat" && alert('artDialog Error: document.compatMode === "BackCompat"') }); var I = F.top = function () { var _ = A, $ = function (_) { try { var B = A[_].document; B.getElementsByTagName } catch ($) { return false } return A[_].artDialog && B.getElementsByTagName("frameset").length === 0 }; if ($("top")) _ = A.top; else if ($("parent")) _ = A.parent; return _ } (); F.parent = I; B = I.artDialog; $ = function () { return B.defaults.zIndex }; F.data = function (_, A) { var B = F.top, $ = B[J] || {}; B[J] = $; if (A !== C) $[_] = A; else return $[_]; return $ }; F.removeData = function (_) { var $ = F.top[J]; if ($ && $[_]) delete $[_] }; F.through = K = function () { var $ = B.apply(this, arguments); if (I !== A) F.list[$.config.id] = $; return $ }; I !== A && D(A).bind("unload", function () { var _ = F.list, $; for (var A in _) if (_[A]) { $ = _[A].config; if ($) $.duration = 0; _[A].close() } }); F.open = function (P, Z, J) { Z = Z || {}; var V, S, R, M, T, N, O, a, I, Y = F.top, X = "position:absolute;left:-9999em;top:-9999em;border:none 0;background:transparent", L = "width:100%;height:100%;border:none 0"; if (J === false) { var G = +new Date, B = P.replace(/([?&])_=[^&]*/, "$1_=" + G); P = B + ((B === P) ? (/\?/.test(P) ? "&" : "?") + "_=" + G : "") } var W = function () { var E, B, A = S.content.find(".aui_loading"), C = V.config; R.addClass("aui_state_full"); A && A.hide(); try { a = T.contentWindow; O = D(a.document); I = a.document.body } catch ($) { T.style.cssText = L; C.follow ? V.follow(C.follow) : V.position(C.left, C.top); Z.init && Z.init.call(V, a, Y); Z.init = null; return } E = C.width === "auto" ? O.width() + (_ ? 0 : parseInt(D(I).css("marginLeft"))) : C.width; B = C.height === "auto" ? O.height() : C.height; setTimeout(function () { T.style.cssText = L }, 0); V.size(E, B); C.follow ? V.follow(C.follow) : V.position(C.left, C.top); Z.init && Z.init.call(V, a, Y); Z.init = null }, U = { zIndex: $(), init: function () { V = this; S = V.DOM; M = S.main; R = S.content; T = V.iframe = Y.document.createElement("iframe"); T.src = P; T.name = "Open" + V.config.id; T.style.cssText = X; T.setAttribute("frameborder", 0, 0); T.setAttribute("allowTransparency", true); N = D(T); V.content().appendChild(T); a = T.contentWindow; try { a.name = T.name; F.data(T.name + H, V); F.data(T.name + E, A) } catch ($) { } function _() { if (W != null) W(); W = null } N.bind("load", _); setTimeout(_, 2000) }, close: function () { N.css("display", "none").unbind("load", W); if (Z.close && Z.close.call(this, T.contentWindow, Y) === false) return false; R.removeClass("aui_state_full"); N[0].src = "about:blank"; N.remove(); try { F.removeData(T.name + H); F.removeData(T.name + E) } catch ($) { } } }; if (typeof Z.ok === "function") U.ok = function () { return Z.ok.call(V, T.contentWindow, Y) }; if (typeof Z.cancel === "function") U.cancel = function () { return Z.cancel.call(V, T.contentWindow, Y) }; delete Z.content; for (var Q in Z) if (U[Q] === C) U[Q] = Z[Q]; return K(U) }; F.open.api = F.data(G + H); F.opener = F.data(G + E) || A; F.open.origin = F.opener; F.close = function () { var $ = F.data(G + H); $ && $.close(); return false }; I != A && D(document).bind("mousedown", function () { var $ = F.open.api; $ && $.zIndex() }); F.load = function (E, G, _) { _ = _ || false; var B = G || {}, A = { zIndex: $(), init: function (A) { var $ = this, C = $.config; D.ajax({ url: E, success: function (_) { $.content(_); B.init && B.init.call($, A) }, cache: _ }) } }; delete G.content; for (var F in B) if (A[F] === C) A[F] = B[F]; return K(A) }; F.alert = function (_, A) { return K({ id: "Alert", zIndex: $(), icon: "warning", fixed: true, lock: true, content: _, ok: true, close: A }) }; F.confirm = function (A, _, B) { return K({ id: "Confirm", zIndex: $(), icon: "question", fixed: true, lock: true, opacity: 0.1, content: A, ok: function ($) { return _.call(this, $) }, cancel: function ($) { return B && B.call(this, $) } }) }; F.prompt = function (A, _, C) { C = C || ""; var B; return K({ id: "Prompt", zIndex: $(), icon: "question", fixed: true, lock: true, opacity: 0.1, content: ['<div style="margin-bottom:5px;font-size:12px">', A, "</div>", "<div>", '<input value="', C, '" style="width:18em;padding:6px 4px" />', "</div>"].join(""), init: function () { B = this.DOM.content.find("input")[0]; B.select(); B.focus() }, ok: function ($) { return _ && _.call(this, B.value, $) }, cancel: true }) }; F.tips = function (_, A) { return K({ id: "Tips", zIndex: $(), title: false, cancel: false, fixed: true, lock: false }).content('<div style="padding: 0 1em;">' + _ + "</div>").time(A || 1.5) }; D(function () { var E = F.dragEvent; if (!E) return; var I = D(A), $ = D(document), G = _ ? "absolute" : "fixed", B = E.prototype, H = document.createElement("div"), C = H.style; C.cssText = "display:none;position:" + G + ";left:0;top:0;width:100%;height:100%;" + "cursor:move;filter:alpha(opacity=0);opacity:0;background:#FFF"; document.body.appendChild(H); B._start = B.start; B._end = B.end; B.start = function () { var A = F.focus.DOM, D = A.main[0], _ = A.content[0].getElementsByTagName("iframe")[0]; B._start.apply(this, arguments); C.display = "block"; C.zIndex = F.defaults.zIndex + 3; if (G === "absolute") { C.width = I.width() + "px"; C.height = I.height() + "px"; C.left = $.scrollLeft() + "px"; C.top = $.scrollTop() + "px" } if (_ && D.offsetWidth * D.offsetHeight > 307200) D.style.visibility = "hidden" }; B.end = function () { var $ = F.focus; B._end.apply(this, arguments); C.display = "none"; if ($) $.DOM.main[0].style.visibility = "visible" } }) })(this.art || this.jQuery, this, this.artDialog)