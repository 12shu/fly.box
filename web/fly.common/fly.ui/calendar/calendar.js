!function () { var tmpl = '<form class="f-calendar">        <div class="f-calendar-left f-un-select" >            <div class="f-calendar-controls">                <select style="font-size: 9pt" onchange="@uid.changeCld()" class="select-year">                    {@js}                        for (i = 1900; i < 2101; i++)                             echo("<option value={0} >{0}\u5e74</option>".format(i))                    {js@}                </select>                <a class=f-calendar-previous-month onclick="@uid.pushBtm(\'MU\',this);return false;">&lt;</a><select style="font-size: 9pt" onchange="@uid.changeCld()" class="select-month">                    {@js}                        for (i = 1; i < 13; i++)                             echo("<option value={0} >{0}\u6708</option>".format(i))                    {js@}                </select><a class=f-calendar-next-month onclick="@uid.pushBtm(\'MD\',this);return false;">&gt;</a>                <a class=f-calendar-current-month onclick="@uid.pushBtm(\'\',this);return false;">\u4eca\u5929</a>            </div>            <div class="f-calendar-week"><span>\u4e00</span><span>\u4e8c</span><span>\u4e09</span><span>\u56db</span><span>\u4e94</span><span class=f-calendar-week-6 >\u516d</span><span class=f-calendar-week-0 >\u65e5</span></div>            <div class="f-calendar-days">                {@js}                    var day;                    for (i = 0; i < 6; i++) {                        echo(\'<div class="f-calendar-day-line f-calendar-day-line-{0}">\'.format(i));                        for (j = 0; j < 7; j++) {                            day = (i * 7 + j);                            var html = \'<span><span class=f-calendar-day-g ></span><span class=f-calendar-day-l ></span></span>\'.format(day);                            echo(html)                        }                        echo("</div>");                    }                {js@}            </div>        </div>        <div class=f-calendar-right >            <div class=f-calendar-current-title ></div>            <div class=f-calendar-current-day ></div>            <div class=f-calendar-current-day-l ></div>            <div class=f-calendar-current-day-ly ></div>            <div class=f-calendar-current-day-lmd ></div>            <div class=f-calendar-current-day-detail ></div>        </div>    </form>    '; tmpl = tmpl.format(); var lunarInfo = new Array(19416, 19168, 42352, 21717, 53856, 55632, 21844, 22191, 39632, 21970, 19168, 42422, 42192, 53840, 53845, 46415, 54944, 44450, 38320, 18807, 18815, 42160, 46261, 27216, 27968, 43860, 11119, 38256, 21234, 18800, 25958, 54432, 59984, 27285, 23263, 11104, 34531, 37615, 51415, 51551, 54432, 55462, 46431, 22176, 42420, 9695, 37584, 53938, 43344, 46423, 27808, 46416, 21333, 19887, 42416, 17779, 21183, 43432, 59728, 27296, 44710, 43856, 19296, 43748, 42352, 21088, 62051, 55632, 23383, 22176, 38608, 19925, 19152, 42192, 54484, 53840, 54616, 46400, 46752, 38310, 38335, 18864, 43380, 42160, 45690, 27216, 27968, 44870, 43872, 38256, 19189, 18800, 25776, 29859, 59984, 27480, 23232, 43872, 38613, 37600, 51552, 55636, 54432, 55888, 30034, 22176, 43959, 9680, 37584, 51893, 43344, 46240, 47780, 44368, 21977, 19360, 42416, 20854, 21183, 43312, 31060, 27296, 44368, 23378, 19296, 42726, 42208, 53856, 60005, 54576, 23200, 30371, 38608, 19195, 19152, 42192, 53430, 53855, 54560, 56645, 46496, 22224, 21938, 18864, 42359, 42160, 43600, 45653, 27951, 44448, 19299, 37759, 18936, 18800, 25776, 26790, 59999, 27424, 42692, 43759, 37600, 53987, 51552, 54615, 54432, 55888, 23893, 22176, 42704, 21972, 21200, 43448, 43344, 46240, 46758, 44368, 21920, 43940, 42416, 21168, 45683, 26928, 29495, 27296, 44368, 19285, 19311, 42352, 21732, 53856, 59752, 54560, 55968, 27302, 22239, 19168, 43476, 42192, 53584, 62034, 54560), solarMonth = new Array(31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31), Gan = new Array("\u7532", "\u4e59", "\u4e19", "\u4e01", "\u620a", "\u5df1", "\u5e9a", "\u8f9b", "\u58ec", "\u7678"), Zhi = new Array("\u5b50", "\u4e11", "\u5bc5", "\u536f", "\u8fb0", "\u5df3", "\u5348", "\u672a", "\u7533", "\u9149", "\u620c", "\u4ea5"), Animals = new Array("\u9f20", "\u725b", "\u864e", "\u5154", "\u9f99", "\u86c7", "\u9a6c", "\u7f8a", "\u7334", "\u9e21", "\u72d7", "\u732a"), solarTerm = new Array("\u5c0f\u5bd2", "\u5927\u5bd2", "\u7acb\u6625", "\u96e8\u6c34", "\u60ca\u86f0", "\u6625\u5206", "\u6e05\u660e", "\u8c37\u96e8", "\u7acb\u590f", "\u5c0f\u6ee1", "\u8292\u79cd", "\u590f\u81f3", "\u5c0f\u6691", "\u5927\u6691", "\u7acb\u79cb", "\u5904\u6691", "\u767d\u9732", "\u79cb\u5206", "\u5bd2\u9732", "\u971c\u964d", "\u7acb\u51ac", "\u5c0f\u96ea", "\u5927\u96ea", "\u51ac\u81f3"), sTermInfo = new Array(0, 21208, 42467, 63836, 85337, 107014, 128867, 150921, 173149, 195551, 218072, 240693, 263343, 285989, 308563, 331033, 353350, 375494, 397447, 419210, 440795, 462224, 483532, 504758), nStr1 = new Array("\u65e5", "\u4e00", "\u4e8c", "\u4e09", "\u56db", "\u4e94", "\u516d", "\u4e03", "\u516b", "\u4e5d", "\u5341"), nStr2 = new Array("\u521d", "\u5341", "\u5eff", "\u5345", " "), sFtv = new Array("0101*\u5143\u65e6", "0214  \u60c5\u4eba\u8282", "0308  \u5987\u5973\u8282", "0312  \u690d\u6811\u8282", "0315  \u6d88\u8d39\u8005\u6743\u76ca\u4fdd\u62a4\u65e5", "0401  \u611a\u4eba\u8282", "0501*\u56fd\u9645\u52b3\u52a8\u8282", "0504  \u4e2d\u56fd\u9752\u5e74\u8282", "0531  \u4e16\u754c\u65e0\u70df\u65e5", "0601  \u56fd\u9645\u513f\u7ae5\u8282", "0801  \u516b\u4e00\u5efa\u519b\u8282", "0910  \u6559\u5e08\u8282", "0918  \u4e5d\xb7\u4e00\u516b\u4e8b\u53d8\u7eaa\u5ff5\u65e5", "1001*\u56fd\u5e86\u8282", "1031  \u4e07\u5723\u8282", "1209  \u4e16\u754c\u8db3\u7403\u65e5", "1224  \u5e73\u5b89\u591c", "1225  \u5723\u8bde\u8282"), lFtv = new Array("0101*\u6625\u8282", "0115  \u5143\u5bb5\u8282", "0202  \u9f99\u62ac\u5934", "0505*\u7aef\u5348\u8282", "0707  \u4e03\u5915\u60c5\u4eba\u8282", "0714  \u9b3c\u8282(\u5357\u65b9)", "0815*\u4e2d\u79cb\u8282", "0909  \u91cd\u9633\u8282", "1208  \u814a\u516b\u8282", "1223  \u8fc7\u5c0f\u5e74", "0100*\u9664\u5915"), wFtv = new Array("0520  \u6bcd\u4eb2\u8282", "0630  \u7236\u4eb2\u8282", "1144  \u611f\u6069\u8282"); function lYearDays(_) { var A, $ = 348; for (A = 32768; A > 8; A >>= 1) $ += (lunarInfo[_ - 1900] & A) ? 1 : 0; return ($ + leapDays(_)) } function leapDays($) { if (leapMonth($)) return ((lunarInfo[$ - 1899] & 15) == 15 ? 30 : 29); else return (0) } function leapMonth(_) { var $ = lunarInfo[_ - 1900] & 15; return ($ == 15 ? 0 : $) } function monthDays(_, $) { return ((lunarInfo[_ - 1900] & (65536 >> $)) ? 30 : 29) } function Lunar(_) { var C, B = 0, $ = 0, A = (Date.UTC(_.getFullYear(), _.getMonth(), _.getDate()) - Date.UTC(1900, 0, 31)) / 86400000; for (C = 1900; C < 2100 && A > 0; C++) { $ = lYearDays(C); A -= $ } if (A < 0) { A += $; C-- } this.year = C; B = leapMonth(C); this.isLeap = false; for (C = 1; C < 13 && A > 0; C++) { if (B > 0 && C == (B + 1) && this.isLeap == false) { --C; this.isLeap = true; $ = leapDays(this.year) } else $ = monthDays(this.year, C); if (this.isLeap == true && C == (B + 1)) this.isLeap = false; A -= $ } if (A == 0 && B > 0 && C == B + 1) if (this.isLeap) this.isLeap = false; else { this.isLeap = true; --C } if (A < 0) { A += $; --C } this.month = C; this.day = A + 1 } function solarDays(_, $) { if ($ == 1) return (((_ % 4 == 0) && (_ % 100 != 0) || (_ % 400 == 0)) ? 29 : 28); else return (solarMonth[$]) } function cyclical($) { return (Gan[$ % 10] + Zhi[$ % 12]) } function calElement(G, C, B, I, A, F, E, H, $, _, D) { this.date = new Date(G, C - 1, B, 0, 0, 0, 0); this.isToday = false; this.sYear = G; this.sMonth = C; this.sDay = B; this.week = I; this.weekName = nStr1[I]; this.lYear = A; this.lMonth = F; this.lDay = E; this.isLeap = H; this.cYear = $; this.cMonth = _; this.cDay = D; this.color = ""; this.lunarFestival = ""; this.solarFestival = ""; this.solarTerms = "" } function sTerm(A, $) { var _ = new Date((31556925974.7 * (A - 1900) + sTermInfo[$] * 60000) + Date.UTC(1900, 0, 6, 2, 5)); return (_.getUTCDate()) } function calendar(U, F) { var T, W, _, I, P = 1, G, $ = 0, L, K, M, E, N, S, B = new Array(3), C = 0, O = 0; T = new Date(U, F, 1, 0, 0, 0, 0); this.length = solarDays(U, F); this.firstWeek = T.getDay(); if (F < 2) E = cyclical(U - 1900 + 36 - 1); else E = cyclical(U - 1900 + 36); var D = sTerm(U, 2), Q = sTerm(U, F * 2); N = cyclical((U - 1900) * 12 + F + 12); var H = Date.UTC(U, F, 1, 0, 0, 0, 0) / 86400000 + 25567 + 10; for (var J = 0; J < this.length; J++) { if (P > $) { T = new Date(U, F, J + 1); W = new Lunar(T); _ = W.year; I = W.month; P = W.day; G = W.isLeap; $ = G ? leapDays(_) : monthDays(_, I); if (C == 0) O = I; B[C++] = J - P + 1 } if (F == 1 && (J + 1) == D) E = cyclical(U - 1900 + 36); if ((J + 1) == Q) N = cyclical((U - 1900) * 12 + F + 13); S = cyclical(H + J); var V = (J + this.firstWeek) % 7; this[J] = new calElement(U, F + 1, J + 1, V, _, I, P++, G, E, N, S) } L = sTerm(U, F * 2) - 1; K = sTerm(U, F * 2 + 1) - 1; this[L].solarTerms = solarTerm[F * 2]; this[K].solarTerms = solarTerm[F * 2 + 1]; for (J = 0; J < sFtv.length; J++) if (sFtv[J].match(/^(\d{2})(\d{2})([\s\*])(.+)$/)) if (Number(RegExp.$1) == (F + 1)) { var R = this[Number(RegExp.$2) - 1]; R.solarFestival += RegExp.$4 + "  " } for (J = 0; J < wFtv.length; J++) if (wFtv[J].match(/^(\d{2})(\d)(\d)([\s\*])(.+)$/)) if (Number(RegExp.$1) == (F + 1)) { L = Number(RegExp.$2); K = Number(RegExp.$3); var A = this[((this.firstWeek > K) ? 7 : 0) + 7 * (L - 1) + K - this.firstWeek]; A && (A.solarFestival += RegExp.$5 + "  ") } for (J = 0; J < lFtv.length; J++) if (lFtv[J].match(/^(\d{2})(.{2})([\s\*])(.+)$/)) { L = Number(RegExp.$1) - O; if (L == -11) L = 1; if (L >= 0 && L < C) { K = B[L] + Number(RegExp.$2) - 1; if (K >= 0 && K < this.length) { this[K].lunarFestival += RegExp.$4 + "  "; if (RegExp.$3 == "*") this[K].color = "red" } } } if (U == todayYear && F == todayMonth) this[tD - 1].isToday = true } function cDay($) { var _; switch ($) { case 10: _ = "\u521d\u5341"; break; case 20: _ = "\u4e8c\u5341"; break; break; case 30: _ = "\u4e09\u5341"; break; break; default: _ = nStr2[Math.floor($ / 10)]; _ += nStr1[$ % 10] } return (_) } var cld, Today = new Date(), todayYear = Today.getFullYear(), todayMonth = Today.getMonth(), tD = Today.getDate(), width = "130", offsetX = 2, offsetY = 18, x = 0, y = 0, snow = 0, sw = 0, cnt = 0, dStyle; document.onmousemove = mEvn; function getAstro(A, B) { var $ = "\u9b54\u7faf\u6c34\u74f6\u53cc\u9c7c\u767d\u7f8a\u91d1\u725b\u53cc\u5b50\u5de8\u87f9\u72ee\u5b50\u5904\u5973\u5929\u79e4\u5929\u874e\u5c04\u624b\u9b54\u7faf", _ = [20, 19, 21, 21, 21, 22, 23, 23, 23, 23, 22, 22]; return $.substr(A * 2 - (B < _[A - 1] ? 2 : 0), 2) } function FormatLunarMonth(_) { var $ = new String("\u6b63\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341"), A; if (_ <= 10) A = $.substr(_ - 1, 1); else if (_ == 11) A = "\u5341\u4e00"; else A = "\u5341\u4e8c"; return A + "\u6708" } function FormatLunarDay(B) { var $ = new String("\u521d\u5341\u5eff\u4e09"), _ = new String("\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341"), A; if ((B != 20) && (B != 30)) A = $.substr((B - 1) / 10, 1) + _.substr((B - 1) % 10, 1); else if (B != 20) A = $.substr(B / 10, 1) + "\u5341"; else A = "\u4e8c\u5341"; return A } function mEvn($) { $ = $ ? $ : (window.event ? window.event : null); if (document.body.scrollLeft) { x = $.x + document.body.scrollLeft; y = $.y + document.body.scrollTop } else { x = $.x ? $.x : $.pageX; y = $.y ? $.y : $.pageY } if (snow) if (navigator.userAgent.indexOf("MSIE") >= 0) { dStyle.left = x + offsetX - (width / 2); dStyle.top = y + offsetY } else { dStyle.left = x - 432; dStyle.top = y + 10 } } window.Calendar = function (_) { $.extend(this, _); var A = this; setTimeout(function () { A.createMemebers(); A.setEvents() }) }; window.Calendar.prototype = { templete: tmpl, createMemebers: function () { var _ = $(this.container); this.id = "f" + Math.random().toString().substr(3); window[this.id] = this; this.dom = $(this.templete.replace(/@uid/g, this.id)); this.css && this.dom.addClass(this.css); this.currentBlockPos && this.dom.addClass("f-calendar-current-" + this.currentBlockPos); this.lunarIsShow == false && this.dom.addClass("f-calendar-no-lunar"); this.selectYear = this.dom.$(".select-year")[0]; this.selectMonth = this.dom.$(".select-month")[0]; _.append(this.dom); this.dayBoxs = this.dom.$(".f-calendar-day-line>"); this.dayBoxsG = this.dom.$(".f-calendar-day-g"); this.dayBoxsL = this.dom.$(".f-calendar-day-l"); this.selectYear.selectedIndex = todayYear - 1900; this.selectMonth.selectedIndex = todayMonth; this.drawCld(todayYear, todayMonth); this.setCurrentDay(this.cld.today) }, mOut: function () { if (cnt >= 1) sw = 0; if (sw == 0) { snow = 0; dStyle.visibility = "hidden" } else cnt++ }, mOvr: function (v) { return; var s, festival, sObj = eval("SD" + v), d = sObj.innerHTML - 1; if (!cld[d]) return; var myxz = getAstro(cld[d].sMonth, cld[d].sDay); if (sObj.innerHTML != "") { sObj.style.cursor = "default"; if (cld[d].solarTerms == "" && cld[d].solarFestival == "" && cld[d].lunarFestival == "") festival = ""; else festival = '<TABLE  WIDTH=100%  BORDER=0  CELLPADDING=2  CELLSPACING=0  BGCOLOR="#CCFFCC"><TR><TD>' + '<FONT  COLOR="#000000"  STYLE="font-size:9pt;">' + cld[d].solarTerms + "  " + cld[d].solarFestival + "  " + cld[d].lunarFestival + "</FONT></TD>" + "</TR></TABLE>"; s = '<TABLE  WIDTH="130"  BORDER=0  CELLPADDING="2"  CELLSPACING=0  BGCOLOR="#0099FF"><TR><TD>' + '<TABLE  WIDTH=100%  BORDER=0  CELLPADDING=0  CELLSPACING=0><TR><TD  ALIGN="right"><FONT  COLOR="#ffffff"  STYLE="font-size:9pt;">' + cld[d].sYear + "  \u5e74  " + cld[d].sMonth + "  \u6708  " + cld[d].sDay + "  \u65e5<br>\u661f\u671f" + cld[d].weekName + " " + myxz + "\u5ea7<br>" + '<font  color="#FFCCCC">\u519c\u5386' + (cld[d].isLeap ? "\u95f0  " : "  ") + FormatLunarMonth(cld[d].lMonth) + FormatLunarDay(cld[d].lDay) + "</font><br>" + '<font  color="yellow">' + cld[d].cYear + "\u5e74  " + cld[d].cMonth + "\u6708  " + cld[d].cDay + "\u65e5</font>" + "</FONT></TD></TR></TABLE>" + festival + "</TD></TR></TABLE>"; document.getElementById("detail").innerHTML = s; if (snow == 0) { dStyle.left = x + offsetX - (width / 2); dStyle.top = y + offsetY; dStyle.visibility = "visible"; snow = 1 } } }, pushBtm: function (_, $) { switch (_) { case "YU": if (this.selectYear.selectedIndex > 0) this.selectYear.selectedIndex--; break; case "YD": if (this.selectYear.selectedIndex < 200) this.selectYear.selectedIndex++; break; case "MU": if (this.selectMonth.selectedIndex > 0) this.selectMonth.selectedIndex--; else { this.selectMonth.selectedIndex = 11; if (this.selectYear.selectedIndex > 0) this.selectYear.selectedIndex-- } break; case "MD": if (this.selectMonth.selectedIndex < 11) this.selectMonth.selectedIndex++; else { this.selectMonth.selectedIndex = 0; if (this.selectYear.selectedIndex < 200) this.selectYear.selectedIndex++ } break; default: this.selectYear.selectedIndex = todayYear - 1900; this.selectMonth.selectedIndex = todayMonth } this.changeCld(); $.blur() }, drawCld: function (E, C) { var I, A, H; this.cld = cld = new calendar(E, C); for (I = 0; I < 42; I++) { var B = $(this.dayBoxs[I]); B[0].title = ""; B[0].className = "f-calendar-day"; var F = this.dayBoxsG[I], G = this.dayBoxsL[I], _ = I - (cld.firstWeek || 7) + 1; if (_ > -1 && _ < cld.length) { var D = cld[_]; B.addClass("f-calendar-day-" + D.week); B[0].dayIndex = _; B[0].day = new Date(E + "/" + (C + 1) + "/" + (_ + 1)); F.innerHTML = _ + 1; if (D.isToday) { B.addClass("f-calendar-today"); this.cld.today = D } F.style.color = D.color; if (D.lDay == 1) G.innerHTML = "<b>" + (D.isLeap ? "\u95f0" : "") + D.lMonth + "\u6708" + (monthDays(D.lYear, D.lMonth) == 29 ? "\u5c0f" : "\u5927") + "</b>"; else G.innerHTML = cDay(D.lDay); A = []; if (D.lunarFestival) { B.addClass("f-calendar-holiday-l"); A.push(D.lunarFestival) } if (D.solarFestival) { B.addClass("f-calendar-holiday-l"); A.push(D.solarFestival) } if (D.solarTerms) { B.addClass("f-calendar-holiday-24"); A.push(D.solarTerms) } if (A.length) { B.addClass("f-calendar-holiday"); D.holiday = G.title = G.innerHTML = A.join("\u3001") } } else { F.innerHTML = ""; G.innerHTML = ""; B[0].className = "f-calendar-no-day" } } this.fire("draw", this, E, C + 1) }, setCurrentDay: function ($) { this.dom.$(".f-calendar-current-title").text($.date.format("yyyy-MM-dd") + " \u661f\u671f" + $.weekName); this.dom.$(".f-calendar-current-day").text($.sDay); this.dom.$(".f-calendar-current-day-l").text(($.isLeap ? "\u95f0 " : "") + FormatLunarMonth($.lMonth) + FormatLunarDay($.lDay)); this.dom.$(".f-calendar-current-day-ly").text($.cYear + "\u5e74 \u3010" + Animals[($.lYear - 4) % 12] + "\u5e74\u3011"); this.dom.$(".f-calendar-current-day-lmd").text($.cMonth + "\u6708 " + $.cDay + "\u65e5"); this.dom.$(".f-calendar-current-day-detail").text($.holiday || "") }, selectDay: function (_) { var A = $(_).closest(".f-calendar-day"); if (A[0]) { if (this.currentDayDom) { if (this.currentDayDom == A[0]) return; $(this.currentDayDom).removeClass("f-calendar-day-current") } this.currentDayDom = A[0]; A.addClass("f-calendar-day-current"); this.setCurrentDay(cld[this.currentDayDom.dayIndex]) } }, setEvents: function () { var _ = this; $(this.dom).click(function ($, A) { if (A.target.className.contains("f-calendar-day")) _.selectDay(A.target) }) }, changeCld: function () { var _, $; _ = this.selectYear.selectedIndex + 1900; $ = this.selectMonth.selectedIndex; this.drawCld(_, $) }, getBoxByDate: function (A) { if ($.isDate(A)) A = A.getDate() - 1; else A = parseInt(A) - 1; var _ = this.dayBoxs.first("o=>o.dayIndex==" + A); return _ } }; $.Event.eventAble(window.Calendar) } ()